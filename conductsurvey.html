<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conduct Survey | Pingu - Solar</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B35;
            --primary-dark: #E55A2B;
            --secondary: #FFC857;
            --accent: #00D9FF;
            --dark: #1A1A2E;
            --dark-light: #252541;
            --dark-lighter: #2F2F4A;
            --text: #EAEAEA;
            --text-dim: #9A9AB0;
            --success: #4ECCA3;
            --error: #FF6B6B;
            --warning: #FFA500;
            --shadow: rgba(255, 107, 53, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--dark);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 107, 53, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 217, 255, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 200, 87, 0.06) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        header {
            margin-bottom: 2rem;
            animation: slideDown 0.8s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .logo {
            font-family: 'Syne', sans-serif;
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }
        
        .back-btn {
            background: var(--dark-light);
            color: var(--text);
            text-decoration: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .back-btn:hover {
            background: var(--dark-lighter);
            border-color: var(--accent);
        }
        
        h1 {
            font-family: 'Syne', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--text);
        }
        
        .subtitle {
            color: var(--text-dim);
            font-size: 0.95rem;
        }
        
        .survey-form {
            background: var(--dark-light);
            border-radius: 16px;
            padding: 2.5rem;
            border: 2px solid var(--dark-lighter);
            animation: fadeInUp 1s ease-out 0.3s both;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .section-header {
            font-family: 'Syne', sans-serif;
            font-size: 1.5rem;
            color: var(--accent);
            margin: 2rem 0 1.5rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--dark-lighter);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .section-header:first-child {
            margin-top: 0;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            color: var(--text);
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        .form-label.required::after {
            content: ' *';
            color: var(--error);
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            background: var(--dark-lighter);
            border: 2px solid var(--dark-lighter);
            color: var(--text);
            padding: 1rem 1.2rem;
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--dark);
        }
        
        .form-input[type="number"] {
            -moz-appearance: textfield;
        }
        
        .form-input[type="number"]::-webkit-outer-spin-button,
        .form-input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .form-select {
            cursor: pointer;
        }
        
        .form-select option {
            background: var(--dark-lighter);
            color: var(--text);
        }
        
        .radio-group {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .radio-option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
        }
        
        .radio-option label {
            cursor: pointer;
            color: var(--text);
        }
        
        .file-upload-area {
            border: 2px dashed var(--dark-lighter);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            background: var(--dark-lighter);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-top: 0.5rem;
        }
        
        .file-upload-area:hover {
            border-color: var(--primary);
            background: var(--dark);
        }
        
        .file-upload-area.dragover {
            border-color: var(--accent);
            background: var(--dark);
        }
        
        .file-upload-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }
        
        .file-upload-text {
            color: var(--text-dim);
            font-size: 0.9rem;
        }
        
        .file-upload-input {
            display: none;
        }
        
        .uploaded-files {
            margin-top: 1rem;
            display: grid;
            gap: 0.75rem;
        }
        
        .uploaded-file {
            background: var(--dark);
            padding: 1rem;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 2px solid var(--dark-lighter);
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
            min-width: 0;
        }
        
        .file-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .file-details {
            flex: 1;
            min-width: 0;
        }
        
        .file-name {
            color: var(--text);
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .file-size {
            color: var(--text-dim);
            font-size: 0.8rem;
        }
        
        .remove-file-btn {
            background: var(--error);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            flex-shrink: 0;
        }
        
        .remove-file-btn:hover {
            background: #ff4444;
        }
        
        .upload-progress {
            margin-top: 0.5rem;
            background: var(--dark);
            border-radius: 8px;
            padding: 1rem;
            display: none;
        }
        
        .upload-progress.active {
            display: block;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--dark-lighter);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .progress-text {
            color: var(--text-dim);
            font-size: 0.85rem;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: none;
        }
        
        .alert.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        .alert.error {
            background: rgba(255, 107, 107, 0.2);
            color: var(--error);
            border: 2px solid var(--error);
        }
        
        .alert.success {
            background: rgba(78, 204, 163, 0.2);
            color: var(--success);
            border: 2px solid var(--success);
        }
        
        .alert.warning {
            background: rgba(255, 165, 0, 0.2);
            color: var(--warning);
            border: 2px solid var(--warning);
        }
        
        .submit-btn {
            padding: 1.2rem 2rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border: none;
            border-radius: 12px;
            font-family: 'Syne', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 2rem;
        }
        
        .submit-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px var(--shadow);
        }
        
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .job-info-card {
            background: var(--dark-lighter);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 2px solid var(--success);
            display: none;
        }
        
        .job-info-card.show {
            display: block;
            animation: fadeInUp 0.5s ease;
        }
        
        .job-info-header {
            font-family: 'Syne', sans-serif;
            font-size: 1.3rem;
            color: var(--success);
            margin-bottom: 1rem;
        }
        
        .job-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .job-info-item {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }
        
        .job-info-label {
            color: var(--text-dim);
            font-size: 0.8rem;
            text-transform: uppercase;
        }
        
        .job-info-value {
            color: var(--text);
            font-size: 1rem;
            font-weight: 500;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
            color: var(--text-dim);
        }
        
        .loading-spinner.active {
            display: block;
        }
        
        .conditional-field {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--dark);
            border-radius: 8px;
            border-left: 4px solid var(--warning);
            display: none;
        }
        
        .conditional-field.show {
            display: block;
            animation: fadeInUp 0.3s ease;
        }
        
        .help-text {
            color: var(--text-dim);
            font-size: 0.85rem;
            margin-top: 0.3rem;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .survey-form {
                padding: 1.5rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .section-header {
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <a href="teamview.html" class="logo">Pingu - Solar</a>
                <a href="teamview.html" class="back-btn">
                    ‚Üê Back to Dashboard
                </a>
            </div>
            <h1>Conduct Site Survey</h1>
            <p class="subtitle">Complete comprehensive site survey for solar installation</p>
        </header>
        
        <div class="survey-form">
            <div class="alert" id="alert-message"></div>
            
            <!-- Job Number Verification -->
            <div class="section-header">
                üìã Job Information
            </div>
            
            <div class="form-group">
                <label for="job-number" class="form-label required">Job Number</label>
                <input 
                    type="text" 
                    id="job-number" 
                    class="form-input" 
                    placeholder="Enter job number..."
                    required
                />
            </div>
            
            <button type="button" class="submit-btn" onclick="verifyJobNumber()" id="verify-btn">
                Verify Job Number
            </button>
            
            <div class="loading-spinner" id="loading-spinner">
                Loading job details...
            </div>
            
            <div class="job-info-card" id="job-info-card">
                <div class="job-info-header">‚úì Job Verified</div>
                <div class="job-info-grid" id="job-info-grid"></div>
            </div>
            
            <!-- Survey Form (hidden until job verified) -->
            <form id="survey-form" style="display: none;">
                
                <!-- Survey Details -->
                <div class="section-header">
                    üìÖ Survey Details
                </div>
                
                <div class="form-group">
                    <label for="conducted-on" class="form-label required">Conducted On (Date and Time)</label>
                    <input 
                        type="datetime-local" 
                        id="conducted-on" 
                        class="form-input"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="surveyor" class="form-label required">Surveyor</label>
                    <input 
                        type="text" 
                        id="surveyor" 
                        class="form-input"
                        placeholder="Enter surveyor name..."
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Customer Present During Survey?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="customer-yes" name="customer-present" value="Yes" required>
                            <label for="customer-yes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="customer-no" name="customer-present" value="No">
                            <label for="customer-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="customer-na" name="customer-present" value="N/A">
                            <label for="customer-na">N/A</label>
                        </div>
                    </div>
                </div>
                
                <!-- Electrical System -->
                <div class="section-header">
                    ‚ö° Electrical System
                </div>
                
                <div class="form-group">
                    <label for="meter-position" class="form-label required">Position of Meter Cupboard or Incoming Supply</label>
                    <input 
                        type="text" 
                        id="meter-position" 
                        class="form-input"
                        placeholder="Describe location..."
                        required
                    />
                    <div class="conditional-field" id="meter-position-upload">
                        <label class="form-label required">Upload Photo(s) of Meter Position</label>
                        <div class="file-upload-area" onclick="document.getElementById('meter-position-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="meter-position-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="meter-position-uploaded"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="fuse-rating" class="form-label required">What is the Fuse Rating?</label>
                    <input 
                        type="text" 
                        id="fuse-rating" 
                        class="form-input"
                        placeholder="e.g., 100A..."
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="gateway-location" class="form-label required">Location for Gateway</label>
                    <input 
                        type="text" 
                        id="gateway-location" 
                        class="form-input"
                        placeholder="Describe location..."
                        required
                    />
                    <div class="conditional-field" id="gateway-location-upload">
                        <label class="form-label required">Upload Photo(s) of Gateway Location</label>
                        <div class="file-upload-area" onclick="document.getElementById('gateway-location-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="gateway-location-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="gateway-location-uploaded"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="panel-run" class="form-label required">Describe the Panel Run</label>
                    <textarea 
                        id="panel-run" 
                        class="form-textarea"
                        placeholder="Describe the cable route from panels to inverter..."
                        required
                    ></textarea>
                </div>
                
                <div class="form-group">
                    <label for="panel-run-distance" class="form-label required">Panel Run Distance (m)</label>
                    <input 
                        type="number" 
                        id="panel-run-distance" 
                        class="form-input"
                        placeholder="0.00"
                        step="0.01"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="battery-gateway-run" class="form-label required">Describe the Battery to Gateway Run</label>
                    <textarea 
                        id="battery-gateway-run" 
                        class="form-textarea"
                        placeholder="Describe the cable route from battery to gateway..."
                        required
                    ></textarea>
                    <div class="conditional-field" id="battery-gateway-upload">
                        <label class="form-label required">Upload Photo(s) of Battery to Gateway Run</label>
                        <div class="file-upload-area" onclick="document.getElementById('battery-gateway-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="battery-gateway-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="battery-gateway-uploaded"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="battery-gateway-distance" class="form-label required">Battery to Gateway Distance (m)</label>
                    <input 
                        type="number" 
                        id="battery-gateway-distance" 
                        class="form-input"
                        placeholder="0.00"
                        step="0.01"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="wifi-signal" class="form-label required">Is there WiFi Signal at the Proposed Inverter Location?</label>
                    <input 
                        type="text" 
                        id="wifi-signal" 
                        class="form-input"
                        placeholder="e.g., Yes - strong signal, No - weak signal..."
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="meter-cupboard-photo" class="form-label required">Photo of Meter Cupboard Interior</label>
                    <div class="file-upload-area" onclick="document.getElementById('meter-cupboard-files').click()">
                        <div class="file-upload-icon">üì∏</div>
                        <div class="file-upload-text">Click to upload or drag and drop photos</div>
                    </div>
                    <input type="file" id="meter-cupboard-files" class="file-upload-input" multiple accept="image/*" required>
                    <div class="uploaded-files" id="meter-cupboard-uploaded"></div>
                </div>
                                
                <div class="form-group">
                    <label for="render-cladding" class="form-label required">Any Signs of Render or Cladding?</label>
                    <input 
                        type="text" 
                        id="render-cladding" 
                        class="form-input"
                        placeholder="Describe any render or cladding..."
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="surface-type" class="form-label required">Type of Surface at Battery Location</label>
                    <input 
                        type="text" 
                        id="surface-type" 
                        class="form-input"
                        placeholder="e.g., Concrete, Wood, Brick..."
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="battery-width" class="form-label required">Width (mm)</label>
                    <input 
                        type="number" 
                        id="battery-width" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="battery-depth" class="form-label required">Depth (mm)</label>
                    <input 
                        type="number" 
                        id="battery-depth" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="battery-length" class="form-label required">Length (mm)</label>
                    <input 
                        type="number" 
                        id="battery-length" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="additional-notes-battery" class="form-label">Additional Notes</label>
                    <textarea 
                        id="additional-notes-battery" 
                        class="form-textarea"
                        placeholder="Any additional information about the battery location..."
                    ></textarea>
                </div>
                
                <div class="form-group">
                    <label for="battery-location" class="form-label required">Battery/Powerwall Location</label>
                    <input 
                        type="text" 
                        id="battery-location" 
                        class="form-input"
                        placeholder="Describe the location..."
                        required
                    />
                    <div class="conditional-field" id="battery-location-upload">
                        <label class="form-label required">Upload Photo(s) of Battery Location</label>
                        <div class="file-upload-area" onclick="document.getElementById('battery-location-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="battery-location-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="battery-location-uploaded"></div>
                    </div>
                </div>
                
                <!-- Roof Details -->
                <div class="section-header">
                    üè† External Measurements
                </div>
                
                <div class="form-group">
                    <label for="roof-covering" class="form-label required">What is the Roof Covering Type?</label>
                    <input 
                        type="text" 
                        id="roof-covering" 
                        class="form-input"
                        placeholder="e.g., Tiles, Slate, Metal..."
                        required
                    />
                    <div class="conditional-field" id="roof-covering-upload">
                        <label class="form-label required">Upload Photo(s) of Roof Covering</label>
                        <div class="file-upload-area" onclick="document.getElementById('roof-covering-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="roof-covering-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="roof-covering-uploaded"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="number-stories" class="form-label required">Number of Stories</label>
                    <input 
                        type="number" 
                        id="number-stories" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="1"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="roof-age" class="form-label required">How Old is the Roof in Years?</label>
                    <input 
                        type="number" 
                        id="roof-age" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                    <div class="help-text">If less than 1 year, enter 0</div>
                </div>
                
                <div class="form-group">
                    <label for="roof-work-age" class="form-label required">How Many Years Ago was the Last Work Carried Out on the Roof?</label>
                    <input 
                        type="number" 
                        id="roof-work-age" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="soffit-overhang" class="form-label required">Distance the Soffit Overhangs (mm)</label>
                    <input 
                        type="number" 
                        id="soffit-overhang" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Are there any Obstructions on the Roof?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="obstructions-yes" name="roof-obstructions" value="Yes" required>
                            <label for="obstructions-yes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="obstructions-no" name="roof-obstructions" value="No">
                            <label for="obstructions-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="obstructions-na" name="roof-obstructions" value="N/A">
                            <label for="obstructions-na">N/A</label>
                        </div>
                    </div>
                    <div class="conditional-field" id="obstructions-upload">
                        <label class="form-label required">Upload Photo(s) of Roof Obstructions</label>
                        <div class="file-upload-area" onclick="document.getElementById('obstructions-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="obstructions-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="obstructions-uploaded"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="building-width" class="form-label required">Building Width (m)</label>
                    <input 
                        type="number" 
                        id="building-width" 
                        class="form-input"
                        placeholder="0.00"
                        step="0.01"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="height-to-ridge" class="form-label required">Height to Ridge (m)</label>
                    <input 
                        type="number" 
                        id="height-to-ridge" 
                        class="form-input"
                        placeholder="0.00"
                        step="0.01"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Is there any Form of Shading?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="shading-yes" name="roof-shading" value="Yes" required>
                            <label for="shading-yes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="shading-no" name="roof-shading" value="No">
                            <label for="shading-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="shading-na" name="roof-shading" value="N/A">
                            <label for="shading-na">N/A</label>
                        </div>
                    </div>
                    <div class="conditional-field" id="shading-upload">
                        <label class="form-label required">Upload Photo(s) of Shading</label>
                        <div class="file-upload-area" onclick="document.getElementById('shading-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="shading-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="shading-uploaded"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="nearest-building-distance" class="form-label required">Distance to Nearest Building (m)</label>
                    <input 
                        type="number" 
                        id="nearest-building-distance" 
                        class="form-input"
                        placeholder="0.00"
                        step="0.01"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="obstruction-height" class="form-label required">Height of Nearest Obstruction (m)</label>
                    <input 
                        type="number" 
                        id="obstruction-height" 
                        class="form-input"
                        placeholder="0.00"
                        step="0.01"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="building-length" class="form-label required">Building Length (m)</label>
                    <input 
                        type="number" 
                        id="building-length" 
                        class="form-input"
                        placeholder="0.00"
                        step="0.01"
                        min="0"
                        required
                    />
                </div>

                <!-- Loft Details -->
                <div class="section-header">
                    üèöÔ∏è Main Roof
                </div>
                
                <div class="form-group">
                    <label for="roof-type" class="form-label required">What is the Roof Type?</label>
                    <input 
                        type="text" 
                        id="roof-type" 
                        class="form-input"
                        placeholder="e.g., Gable, Hip, Flat..."
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Is the Loft Accessible?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="loft-accessible-yes" name="loft-accessible" value="Yes" required>
                            <label for="loft-accessible-yes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="loft-accessible-no" name="loft-accessible" value="No">
                            <label for="loft-accessible-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="loft-accessible-na" name="loft-accessible" value="N/A">
                            <label for="loft-accessible-na">N/A</label>
                        </div>
                    </div>
                    <div class="conditional-field" id="loft-accessible-upload">
                        <label class="form-label required">Upload Photo(s) of Loft Access</label>
                        <div class="file-upload-area" onclick="document.getElementById('loft-accessible-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="loft-accessible-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="loft-accessible-uploaded"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="loft-hatch-width" class="form-label required">Loft Hatch Width (mm)</label>
                    <input 
                        type="number" 
                        id="loft-hatch-width" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="loft-hatch-depth" class="form-label required">Loft Hatch Depth (mm)</label>
                    <input 
                        type="number" 
                        id="loft-hatch-depth" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Is a Loft Ladder Installed?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="loft-ladder-yes" name="loft-ladder" value="Yes" required>
                            <label for="loft-ladder-yes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="loft-ladder-no" name="loft-ladder" value="No">
                            <label for="loft-ladder-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="loft-ladder-na" name="loft-ladder" value="N/A">
                            <label for="loft-ladder-na">N/A</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Is the Loft Boarded?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="loft-boarded-yes" name="loft-boarded" value="Yes" required>
                            <label for="loft-boarded-yes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="loft-boarded-no" name="loft-boarded" value="No">
                            <label for="loft-boarded-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="loft-boarded-na" name="loft-boarded" value="N/A">
                            <label for="loft-boarded-na">N/A</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="loft-hatch-clearance" class="form-label required">Loft Hatch Clearance (mm)</label>
                    <input 
                        type="number" 
                        id="loft-hatch-clearance" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="ridge-to-eaves" class="form-label required">Ridge to Eaves (mm)</label>
                    <input 
                        type="number" 
                        id="ridge-to-eaves" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="roof-length-bottom" class="form-label required">Length of Roof - Bottom (mm) (i.e. along eaves)</label>
                    <input 
                        type="number" 
                        id="roof-length-bottom" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="roof-pitch" class="form-label required">Roof Pitch (degrees)</label>
                    <input 
                        type="number" 
                        id="roof-pitch" 
                        class="form-input"
                        placeholder="0"
                        step="0.1"
                        min="0"
                        max="90"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="roof-length-top" class="form-label required">Length of Roof - Top (mm) (i.e. along ridge)</label>
                    <input 
                        type="number" 
                        id="roof-length-top" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="rafter-width" class="form-label required">Rafter Width (mm)</label>
                    <input 
                        type="number" 
                        id="rafter-width" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="rafter-depth" class="form-label required">Rafter Depth (mm)</label>
                    <input 
                        type="number" 
                        id="rafter-depth" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="web-width" class="form-label required">Web Width (mm)</label>
                    <input 
                        type="number" 
                        id="web-width" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="web-depth" class="form-label required">Web Depth (mm)</label>
                    <input 
                        type="number" 
                        id="web-depth" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="web-length" class="form-label required">Web Length (mm)</label>
                    <input 
                        type="number" 
                        id="web-length" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="truss-spacing" class="form-label required">Truss Spacing (mm)</label>
                    <input 
                        type="number" 
                        id="truss-spacing" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="roof-diagram" class="form-label required">Sketch Roof Diagram and Label</label>
                    <div class="file-upload-area" onclick="document.getElementById('roof-diagram-files').click()">
                        <div class="file-upload-icon">üì∏</div>
                        <div class="file-upload-text">Click to upload or drag and drop photo</div>
                    </div>
                    <input type="file" id="roof-diagram-files" class="file-upload-input" accept="image/*" required>
                    <div class="uploaded-files" id="roof-diagram-uploaded"></div>
                </div>
                
                <!-- Risk Assessment & Property Photos -->
                <div class="section-header">
                    ‚ö†Ô∏è Personal Risk Assessment
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Has a Risk Assessment Been Carried Out in Accordance with the Octopus Energy Site Survey Assessment Document?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="risk-assessment-yes" name="risk-assessment" value="Yes" required>
                            <label for="risk-assessment-yes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="risk-assessment-no" name="risk-assessment" value="No">
                            <label for="risk-assessment-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="risk-assessment-na" name="risk-assessment" value="N/A">
                            <label for="risk-assessment-na">N/A</label>
                        </div>
                    </div>
                </div>

                <!-- Risk Assessment & Property Photos -->
                <div class="section-header">
                     üèöÔ∏è Property
                </div>
                
                <div class="form-group">
                    <label for="property-photos" class="form-label required">Wide Angle Shots of the Property Including All Property Faces</label>
                    <div class="file-upload-area" onclick="document.getElementById('property-photos-files').click()">
                        <div class="file-upload-icon">üì∏</div>
                        <div class="file-upload-text">Click to upload or drag and drop photos</div>
                    </div>
                    <input type="file" id="property-photos-files" class="file-upload-input" multiple accept="image/*" required>
                    <div class="uploaded-files" id="property-photos-uploaded"></div>
                </div>
                
                <div class="form-group">
                    <label for="property-age" class="form-label required">Age of Property (years)</label>
                    <input 
                        type="number" 
                        id="property-age" 
                        class="form-input"
                        placeholder="0"
                        step="1"
                        min="0"
                        required
                    />
                </div>
                
                <div class="form-group">
                    <label for="additional-notes-property" class="form-label">Additional Notes</label>
                    <textarea 
                        id="additional-notes-property" 
                        class="form-textarea"
                        placeholder="Any additional information about the property..."
                    ></textarea>
                </div>
                
                <!-- Safety Checks -->
                <div class="section-header">
                    üîç Roof Condition
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Are there any Signs of Asbestos?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="asbestos-yes" name="asbestos" value="Yes" required>
                            <label for="asbestos-yes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="asbestos-no" name="asbestos" value="No">
                            <label for="asbestos-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="asbestos-na" name="asbestos" value="N/A">
                            <label for="asbestos-na">N/A</label>
                        </div>
                    </div>
                    <div class="conditional-field" id="asbestos-upload">
                        <label class="form-label required">Upload Photo(s) of Asbestos</label>
                        <div class="file-upload-area" onclick="document.getElementById('asbestos-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="asbestos-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="asbestos-uploaded"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Are there any Signs of Deflection to the Existing Roof Slopes?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="deflection-yes" name="roof-deflection" value="Yes" required>
                            <label for="deflection-yes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="deflection-no" name="roof-deflection" value="No">
                            <label for="deflection-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="deflection-na" name="roof-deflection" value="N/A">
                            <label for="deflection-na">N/A</label>
                        </div>
                    </div>
                    <div class="conditional-field" id="deflection-upload">
                        <label class="form-label required">Upload Photo(s) of Roof Deflection</label>
                        <div class="file-upload-area" onclick="document.getElementById('deflection-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="deflection-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="deflection-uploaded"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Are there any Signs of Rot/Damage to the Internal Roof Structure?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="rot-damage-yes" name="rot-damage" value="Yes" required>
                            <label for="rot-damage-yes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="rot-damage-no" name="rot-damage" value="No">
                            <label for="rot-damage-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="rot-damage-na" name="rot-damage" value="N/A">
                            <label for="rot-damage-na">N/A</label>
                        </div>
                    </div>
                    <div class="conditional-field" id="rot-damage-upload">
                        <label class="form-label required">Upload Photo(s) of Rot/Damage</label>
                        <div class="file-upload-area" onclick="document.getElementById('rot-damage-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="rot-damage-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="rot-damage-uploaded"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Are there any Signs of Anything Which Would Cause for Concern When Fitting Panels to the Roof?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="roof-concern-yes" name="roof-concern" value="Yes" required>
                            <label for="roof-concern-yes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="roof-concern-no" name="roof-concern" value="No">
                            <label for="roof-concern-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="roof-concern-na" name="roof-concern" value="N/A">
                            <label for="roof-concern-na">N/A</label>
                        </div>
                    </div>
                    <div class="conditional-field" id="roof-concern-upload">
                        <label class="form-label required">Upload Photo(s) of Concerns</label>
                        <div class="file-upload-area" onclick="document.getElementById('roof-concern-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="roof-concern-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="roof-concern-uploaded"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Are there any Dwarf Walls/Props Which Support the Purlins?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="dwarf-walls-yes" name="dwarf-walls" value="Yes" required>
                            <label for="dwarf-walls-yes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="dwarf-walls-no" name="dwarf-walls" value="No">
                            <label for="dwarf-walls-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="dwarf-walls-na" name="dwarf-walls" value="N/A">
                            <label for="dwarf-walls-na">N/A</label>
                        </div>
                    </div>
                    <div class="conditional-field" id="dwarf-walls-upload">
                        <label class="form-label required">Upload Photo(s) of Dwarf Walls/Props</label>
                        <div class="file-upload-area" onclick="document.getElementById('dwarf-walls-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="dwarf-walls-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="dwarf-walls-uploaded"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Is there any Signs of Structural Work Which Has Been Carried Out to the Roof Structure Before?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="structural-work-yes" name="structural-work" value="Yes" required>
                            <label for="structural-work-yes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="structural-work-no" name="structural-work" value="No">
                            <label for="structural-work-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="structural-work-na" name="structural-work" value="N/A">
                            <label for="structural-work-na">N/A</label>
                        </div>
                    </div>
                    <div class="conditional-field" id="structural-work-upload">
                        <label class="form-label required">Upload Photo(s) of Structural Work</label>
                        <div class="file-upload-area" onclick="document.getElementById('structural-work-files').click()">
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Click to upload or drag and drop photos</div>
                        </div>
                        <input type="file" id="structural-work-files" class="file-upload-input" multiple accept="image/*">
                        <div class="uploaded-files" id="structural-work-uploaded"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="loft-space-photos" class="form-label required">Wide Angle Inside the Loft Space</label>
                    <div class="file-upload-area" onclick="document.getElementById('loft-space-files').click()">
                        <div class="file-upload-icon">üì∏</div>
                        <div class="file-upload-text">Click to upload or drag and drop photos</div>
                    </div>
                    <input type="file" id="loft-space-files" class="file-upload-input" multiple accept="image/*" required>
                    <div class="uploaded-files" id="loft-space-uploaded"></div>
                </div>
                
                <!-- Submit Button -->
                <button type="submit" class="submit-btn" id="submit-btn">
                    Submit Survey
                </button>
            </form>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, query, where, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyAc_yJQ_rkzuOBh-Yxg0Q4eooXtB-tQjm0",
            authDomain: "pingu-solar.firebaseapp.com",
            projectId: "pingu-solar",
            storageBucket: "pingu-solar.firebasestorage.app",
            messagingSenderId: "232764952866",
            appId: "1:232764952866:web:5923b7f419de6355d6157b",
            measurementId: "G-PFH059DZ64"
        };
        
        console.log('Initializing Firebase...');
        
        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const storage = getStorage(app);
            
            window.db = db;
            window.storage = storage;
            window.firebaseModules = { collection, getDocs, query, where, doc, setDoc, getDoc, ref, uploadBytesResumable, getDownloadURL };
            
            console.log('‚úÖ Firebase initialized successfully');
            
        } catch (error) {
            console.error('‚ùå Firebase initialization error:', error);
        }
    </script>
    
    <script>
        let verifiedJob = null;
        let uploadedFiles = {};
        
        // Show alert message
        function showAlert(message, type = 'error') {
            const alert = document.getElementById('alert-message');
            alert.textContent = message;
            alert.className = `alert ${type} show`;
            
            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Verify job number
        async function verifyJobNumber() {
            const jobNumber = document.getElementById('job-number').value.trim();
            
            if (!jobNumber) {
                showAlert('Please enter a job number', 'error');
                return;
            }
            
            const verifyBtn = document.getElementById('verify-btn');
            const loadingSpinner = document.getElementById('loading-spinner');
            
            verifyBtn.disabled = true;
            verifyBtn.textContent = 'Verifying...';
            loadingSpinner.classList.add('active');
            
            try {
                const { collection, getDocs, query, where } = window.firebaseModules;
                
                const jobsQuery = query(
                    collection(window.db, 'jobs'),
                    where('Job Number', '==', jobNumber)
                );
                
                const querySnapshot = await getDocs(jobsQuery);
                
                if (querySnapshot.empty) {
                    showAlert('Job number not found in database. Please check and try again.', 'error');
                    verifyBtn.disabled = false;
                    verifyBtn.textContent = 'Verify Job Number';
                    loadingSpinner.classList.remove('active');
                    return;
                }
                
                // Job found
                let jobData = null;
                querySnapshot.forEach((doc) => {
                    jobData = { id: doc.id, ...doc.data() };
                });
                
                verifiedJob = jobData;
                
                // Display job info
                const jobInfoGrid = document.getElementById('job-info-grid');
                jobInfoGrid.innerHTML = `
                    <div class="job-info-item">
                        <div class="job-info-label">Job Number</div>
                        <div class="job-info-value">${escapeHtml(jobData['Job Number'] || 'N/A')}</div>
                    </div>
                    <div class="job-info-item">
                        <div class="job-info-label">Customer</div>
                        <div class="job-info-value">${escapeHtml(jobData['Name'] || 'N/A')}</div>
                    </div>
                    <div class="job-info-item">
                        <div class="job-info-label">Address</div>
                        <div class="job-info-value">${escapeHtml(jobData['1st line of address'] || 'N/A')}</div>
                    </div>
                    <div class="job-info-item">
                        <div class="job-info-label">Postcode</div>
                        <div class="job-info-value">${escapeHtml(jobData['Postcode'] || 'N/A')}</div>
                    </div>
                    <div class="job-info-item">
                        <div class="job-info-label">Install Date</div>
                        <div class="job-info-value">${escapeHtml(jobData['Install Date'] || 'TBD')}</div>
                    </div>
                    <div class="job-info-item">
                        <div class="job-info-label">Lead Engineer</div>
                        <div class="job-info-value">${escapeHtml(jobData['Lead Engineer'] || 'Unassigned')}</div>
                    </div>
                `;
                
                document.getElementById('job-info-card').classList.add('show');
                document.getElementById('survey-form').style.display = 'block';
                verifyBtn.style.display = 'none';
                document.getElementById('job-number').disabled = true;
                
                loadingSpinner.classList.remove('active');
                
                showAlert('Job verified successfully! Please complete the survey below.', 'success');
                
            } catch (error) {
                console.error('Error verifying job:', error);
                showAlert('Error verifying job number. Please try again.', 'error');
                verifyBtn.disabled = false;
                verifyBtn.textContent = 'Verify Job Number';
                loadingSpinner.classList.remove('active');
            }
        }
        
        window.verifyJobNumber = verifyJobNumber;
        
        // Setup conditional field triggers
        function setupConditionalFields() {
            // Text fields that require photos when not blank
            const textFieldsWithPhotos = [
                { input: 'meter-position', upload: 'meter-position-upload' },
                { input: 'gateway-location', upload: 'gateway-location-upload' },
                { input: 'battery-gateway-run', upload: 'battery-gateway-upload' },
                { input: 'battery-location', upload: 'battery-location-upload' },
                { input: 'roof-covering', upload: 'roof-covering-upload' }
            ];
            
            textFieldsWithPhotos.forEach(field => {
                const input = document.getElementById(field.input);
                const upload = document.getElementById(field.upload);
                
                input.addEventListener('input', () => {
                    if (input.value.trim()) {
                        upload.classList.add('show');
                    } else {
                        upload.classList.remove('show');
                    }
                });
            });
            
            // Radio buttons that require photos for specific answers
            const radioFieldsWithPhotos = [
                { name: 'roof-obstructions', value: 'Yes', upload: 'obstructions-upload' },
                { name: 'roof-shading', value: 'Yes', upload: 'shading-upload' },
                { name: 'loft-accessible', values: ['Yes', 'No'], upload: 'loft-accessible-upload' },
                { name: 'asbestos', value: 'Yes', upload: 'asbestos-upload' },
                { name: 'roof-deflection', value: 'Yes', upload: 'deflection-upload' },
                { name: 'rot-damage', value: 'Yes', upload: 'rot-damage-upload' },
                { name: 'roof-concern', value: 'Yes', upload: 'roof-concern-upload' },
                { name: 'dwarf-walls', value: 'Yes', upload: 'dwarf-walls-upload' },
                { name: 'structural-work', value: 'Yes', upload: 'structural-work-upload' }
            ];
            
            radioFieldsWithPhotos.forEach(field => {
                const radios = document.querySelectorAll(`input[name="${field.name}"]`);
                const upload = document.getElementById(field.upload);
                
                radios.forEach(radio => {
                    radio.addEventListener('change', () => {
                        const values = Array.isArray(field.values) ? field.values : [field.value];
                        if (values.includes(radio.value)) {
                            upload.classList.add('show');
                        } else {
                            upload.classList.remove('show');
                        }
                    });
                });
            });
        }
        
        // Setup file upload handlers
        function setupFileUploads() {
            const uploadFields = [
                'meter-position-files',
                'gateway-location-files',
                'battery-gateway-files',
                'meter-cupboard-files',
                'battery-location-files',
                'roof-covering-files',
                'obstructions-files',
                'shading-files',
                'loft-accessible-files',
                'roof-diagram-files',
                'property-photos-files',
                'asbestos-files',
                'deflection-files',
                'rot-damage-files',
                'roof-concern-files',
                'dwarf-walls-files',
                'structural-work-files',
                'loft-space-files'
            ];
            
            uploadFields.forEach(fieldId => {
                const input = document.getElementById(fieldId);
                const uploadedDiv = document.getElementById(fieldId.replace('-files', '-uploaded'));
                
                if (!input || !uploadedDiv) return;
                
                uploadedFiles[fieldId] = [];
                
                input.addEventListener('change', (e) => {
                    handleFileSelection(e.target.files, fieldId, uploadedDiv);
                });
            });
        }
        
        function handleFileSelection(files, fieldId, uploadedDiv) {
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    uploadedFiles[fieldId].push(file);
                    displayUploadedFile(file, fieldId, uploadedDiv);
                }
            });
        }
        
        function displayUploadedFile(file, fieldId, uploadedDiv) {
            const fileDiv = document.createElement('div');
            fileDiv.className = 'uploaded-file';
            fileDiv.innerHTML = `
                <div class="file-info">
                    <div class="file-icon">üì∑</div>
                    <div class="file-details">
                        <div class="file-name">${escapeHtml(file.name)}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                </div>
                <button type="button" class="remove-file-btn" onclick="removeFile('${fieldId}', '${file.name}', this)">
                    Remove
                </button>
            `;
            
            uploadedDiv.appendChild(fileDiv);
        }
        
        function removeFile(fieldId, fileName, button) {
            uploadedFiles[fieldId] = uploadedFiles[fieldId].filter(f => f.name !== fileName);
            button.closest('.uploaded-file').remove();
        }
        
        window.removeFile = removeFile;
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }
        
        // Upload file to Firebase Storage
        async function uploadFileToStorage(file, path) {
            const { ref, uploadBytesResumable, getDownloadURL } = window.firebaseModules;
            
            const storageRef = ref(window.storage, path);
            const uploadTask = uploadBytesResumable(storageRef, file);
            
            return new Promise((resolve, reject) => {
                uploadTask.on('state_changed',
                    (snapshot) => {
                        // Progress monitoring can be added here
                    },
                    (error) => {
                        reject(error);
                    },
                    async () => {
                        const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                        resolve(downloadURL);
                    }
                );
            });
        }
        
        // Submit survey
        # Survey Data Structure Implementation Guide

## Overview
This guide explains how to update your survey form to save data in a structured format that includes questions with answers and photos, making it easy to retrieve and generate documents later.

## What Changed

### Before (Old Structure)
```javascript
{
  jobNumber: "OE123456",
  customerName: "John Smith",
  meterPosition: "Front of house",
  fuseRating: "100A",
  photos: {
    "meter-position-files": ["url1", "url2"]
  }
}
```

### After (New Structure)
```javascript
{
  jobNumber: "OE123456",
  customerName: "John Smith",
  sections: [
    {
      title: "Electrical System",
      fields: [
        {
          question: "Position of Meter Cupboard or Incoming Supply",
          answer: "Front of house",
          photos: ["url1", "url2"]
        },
        {
          question: "What is the Fuse Rating?",
          answer: "100A"
        }
      ]
    }
  ]
}
```

## Implementation Steps

### Step 1: Update the `submitSurvey` function in conduct-survey.html

Replace the entire `async function submitSurvey(event)` in your conduct-survey.html with the version below. This is the ONLY change needed in your survey form.

**Location**: Around line 1550-1650 in your conduct-survey.html file

**Find this function:**
```javascript
async function submitSurvey(event) {
    event.preventDefault();
    // ... old code that creates surveyData with individual fields
```

**Replace it with:**
```javascript
async function submitSurvey(event) {
    event.preventDefault();
    
    if (!verifiedJob) {
        showAlert('Please verify job number first', 'error');
        return;
    }
    
    const submitBtn = document.getElementById('submit-btn');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting Survey...';
    
    try {
        // Upload all files first
        const photoUrls = {};
        
        for (const [fieldId, files] of Object.entries(uploadedFiles)) {
            if (files.length > 0) {
                const uploadPromises = files.map(async (file, index) => {
                    const path = `surveys/${verifiedJob['Job Number']}/${fieldId}/${Date.now()}_${index}_${file.name}`;
                    return await uploadFileToStorage(file, path);
                });
                
                photoUrls[fieldId] = await Promise.all(uploadPromises);
            }
        }
        
        // Structure data with questions and answers for easy document generation
        const surveyData = {
            // Metadata
            jobNumber: verifiedJob['Job Number'],
            jobId: verifiedJob.id,
            customerName: verifiedJob['Name'],
            submittedAt: new Date().toISOString(),
            submittedDate: new Date().toLocaleDateString('en-GB'),
            submittedTime: new Date().toLocaleTimeString('en-GB'),
            status: 'completed',
            
            // Structured sections with questions and answers
            sections: [
                {
                    title: 'Job Information',
                    fields: [
                        { question: 'Job Number', answer: verifiedJob['Job Number'] },
                        { question: 'Customer Name', answer: verifiedJob['Name'] },
                        { question: 'Address', answer: verifiedJob['1st line of address'] },
                        { question: 'Postcode', answer: verifiedJob['Postcode'] },
                        { question: 'Install Date', answer: verifiedJob['Install Date'] || 'TBD' },
                        { question: 'Lead Engineer', answer: verifiedJob['Lead Engineer'] || 'Unassigned' }
                    ]
                },
                {
                    title: 'Survey Details',
                    fields: [
                        { question: 'Conducted On (Date and Time)', answer: document.getElementById('conducted-on').value },
                        { question: 'Surveyor', answer: document.getElementById('surveyor').value },
                        { question: 'Customer Present During Survey?', answer: document.querySelector('input[name="customer-present"]:checked')?.value }
                    ]
                },
                {
                    title: 'Electrical System',
                    fields: [
                        { 
                            question: 'Position of Meter Cupboard or Incoming Supply', 
                            answer: document.getElementById('meter-position').value,
                            photos: photoUrls['meter-position-files'] || []
                        },
                        { question: 'What is the Fuse Rating?', answer: document.getElementById('fuse-rating').value },
                        { 
                            question: 'Location for Gateway', 
                            answer: document.getElementById('gateway-location').value,
                            photos: photoUrls['gateway-location-files'] || []
                        },
                        { question: 'Describe the Panel Run', answer: document.getElementById('panel-run').value },
                        { question: 'Panel Run Distance (m)', answer: parseFloat(document.getElementById('panel-run-distance').value) },
                        { 
                            question: 'Describe the Battery to Gateway Run', 
                            answer: document.getElementById('battery-gateway-run').value,
                            photos: photoUrls['battery-gateway-files'] || []
                        },
                        { question: 'Battery to Gateway Distance (m)', answer: parseFloat(document.getElementById('battery-gateway-distance').value) },
                        { question: 'Is there WiFi Signal at the Proposed Inverter Location?', answer: document.getElementById('wifi-signal').value },
                        { 
                            question: 'Photo of Meter Cupboard Interior', 
                            answer: 'See photos',
                            photos: photoUrls['meter-cupboard-files'] || []
                        },
                        { question: 'Any Signs of Render or Cladding?', answer: document.getElementById('render-cladding').value },
                        { question: 'Type of Surface at Battery Location', answer: document.getElementById('surface-type').value },
                        { question: 'Battery Location Width (mm)', answer: parseInt(document.getElementById('battery-width').value) },
                        { question: 'Battery Location Depth (mm)', answer: parseInt(document.getElementById('battery-depth').value) },
                        { question: 'Battery Location Length (mm)', answer: parseInt(document.getElementById('battery-length').value) },
                        { question: 'Additional Notes (Battery)', answer: document.getElementById('additional-notes-battery').value || 'N/A' },
                        { 
                            question: 'Battery/Powerwall Location', 
                            answer: document.getElementById('battery-location').value,
                            photos: photoUrls['battery-location-files'] || []
                        }
                    ]
                },
                {
                    title: 'External Measurements',
                    fields: [
                        { 
                            question: 'What is the Roof Covering Type?', 
                            answer: document.getElementById('roof-covering').value,
                            photos: photoUrls['roof-covering-files'] || []
                        },
                        { question: 'Number of Stories', answer: parseInt(document.getElementById('number-stories').value) },
                        { question: 'How Old is the Roof in Years?', answer: parseInt(document.getElementById('roof-age').value) },
                        { question: 'How Many Years Ago was the Last Work Carried Out on the Roof?', answer: parseInt(document.getElementById('roof-work-age').value) },
                        { question: 'Distance the Soffit Overhangs (mm)', answer: parseInt(document.getElementById('soffit-overhang').value) },
                        { 
                            question: 'Are there any Obstructions on the Roof?', 
                            answer: document.querySelector('input[name="roof-obstructions"]:checked')?.value,
                            photos: photoUrls['obstructions-files'] || []
                        },
                        { question: 'Building Width (m)', answer: parseFloat(document.getElementById('building-width').value) },
                        { question: 'Height to Ridge (m)', answer: parseFloat(document.getElementById('height-to-ridge').value) },
                        { 
                            question: 'Is there any Form of Shading?', 
                            answer: document.querySelector('input[name="roof-shading"]:checked')?.value,
                            photos: photoUrls['shading-files'] || []
                        },
                        { question: 'Distance to Nearest Building (m)', answer: parseFloat(document.getElementById('nearest-building-distance').value) },
                        { question: 'Height of Nearest Obstruction (m)', answer: parseFloat(document.getElementById('obstruction-height').value) },
                        { question: 'Building Length (m)', answer: parseFloat(document.getElementById('building-length').value) }
                    ]
                },
                {
                    title: 'Main Roof',
                    fields: [
                        { question: 'What is the Roof Type?', answer: document.getElementById('roof-type').value },
                        { 
                            question: 'Is the Loft Accessible?', 
                            answer: document.querySelector('input[name="loft-accessible"]:checked')?.value,
                            photos: photoUrls['loft-accessible-files'] || []
                        },
                        { question: 'Loft Hatch Width (mm)', answer: parseInt(document.getElementById('loft-hatch-width').value) },
                        { question: 'Loft Hatch Depth (mm)', answer: parseInt(document.getElementById('loft-hatch-depth').value) },
                        { question: 'Is a Loft Ladder Installed?', answer: document.querySelector('input[name="loft-ladder"]:checked')?.value },
                        { question: 'Is the Loft Boarded?', answer: document.querySelector('input[name="loft-boarded"]:checked')?.value },
                        { question: 'Loft Hatch Clearance (mm)', answer: parseInt(document.getElementById('loft-hatch-clearance').value) },
                        { question: 'Ridge to Eaves (mm)', answer: parseInt(document.getElementById('ridge-to-eaves').value) },
                        { question: 'Length of Roof - Bottom (mm) (i.e. along eaves)', answer: parseInt(document.getElementById('roof-length-bottom').value) },
                        { question: 'Roof Pitch (degrees)', answer: parseFloat(document.getElementById('roof-pitch').value) },
                        { question: 'Length of Roof - Top (mm) (i.e. along ridge)', answer: parseInt(document.getElementById('roof-length-top').value) },
                        { question: 'Rafter Width (mm)', answer: parseInt(document.getElementById('rafter-width').value) },
                        { question: 'Rafter Depth (mm)', answer: parseInt(document.getElementById('rafter-depth').value) },
                        { question: 'Web Width (mm)', answer: parseInt(document.getElementById('web-width').value) },
                        { question: 'Web Depth (mm)', answer: parseInt(document.getElementById('web-depth').value) },
                        { question: 'Web Length (mm)', answer: parseInt(document.getElementById('web-length').value) },
                        { question: 'Truss Spacing (mm)', answer: parseInt(document.getElementById('truss-spacing').value) },
                        { 
                            question: 'Sketch Roof Diagram and Label', 
                            answer: 'See photos',
                            photos: photoUrls['roof-diagram-files'] || []
                        }
                    ]
                },
                {
                    title: 'Personal Risk Assessment',
                    fields: [
                        { 
                            question: 'Has a Risk Assessment Been Carried Out in Accordance with the Octopus Energy Site Survey Assessment Document?', 
                            answer: document.querySelector('input[name="risk-assessment"]:checked')?.value 
                        }
                    ]
                },
                {
                    title: 'Property',
                    fields: [
                        { 
                            question: 'Wide Angle Shots of the Property Including All Property Faces', 
                            answer: 'See photos',
                            photos: photoUrls['property-photos-files'] || []
                        },
                        { question: 'Age of Property (years)', answer: parseInt(document.getElementById('property-age').value) },
                        { question: 'Additional Notes (Property)', answer: document.getElementById('additional-notes-property').value || 'N/A' }
                    ]
                },
                {
                    title: 'Roof Condition',
                    fields: [
                        { 
                            question: 'Are there any Signs of Asbestos?', 
                            answer: document.querySelector('input[name="asbestos"]:checked')?.value,
                            photos: photoUrls['asbestos-files'] || []
                        },
                        { 
                            question: 'Are there any Signs of Deflection to the Existing Roof Slopes?', 
                            answer: document.querySelector('input[name="roof-deflection"]:checked')?.value,
                            photos: photoUrls['deflection-files'] || []
                        },
                        { 
                            question: 'Are there any Signs of Rot/Damage to the Internal Roof Structure?', 
                            answer: document.querySelector('input[name="rot-damage"]:checked')?.value,
                            photos: photoUrls['rot-damage-files'] || []
                        },
                        { 
                            question: 'Are there any Signs of Anything Which Would Cause for Concern When Fitting Panels to the Roof?', 
                            answer: document.querySelector('input[name="roof-concern"]:checked')?.value,
                            photos: photoUrls['roof-concern-files'] || []
                        },
                        { 
                            question: 'Are there any Dwarf Walls/Props Which Support the Purlins?', 
                            answer: document.querySelector('input[name="dwarf-walls"]:checked')?.value,
                            photos: photoUrls['dwarf-walls-files'] || []
                        },
                        { 
                            question: 'Is there any Signs of Structural Work Which Has Been Carried Out to the Roof Structure Before?', 
                            answer: document.querySelector('input[name="structural-work"]:checked')?.value,
                            photos: photoUrls['structural-work-files'] || []
                        },
                        { 
                            question: 'Wide Angle Inside the Loft Space', 
                            answer: 'See photos',
                            photos: photoUrls['loft-space-files'] || []
                        }
                    ]
                }
            ]
        };
        
        // Save to Firebase
        const { doc, setDoc } = window.firebaseModules;
        const surveyId = `${verifiedJob['Job Number']}_${Date.now()}`;
        const surveyRef = doc(window.db, 'site-surveys', surveyId);
        
        await setDoc(surveyRef, surveyData);
        
        console.log('‚úÖ Survey saved with structured data:', surveyId);
        
        showAlert('‚úÖ Survey submitted successfully!', 'success');
        
        // Reset form after 2 seconds
        setTimeout(() => {
            window.location.href = 'teamview.html';
        }, 2000);
        
    } catch (error) {
        console.error('Error submitting survey:', error);
        showAlert('Error submitting survey. Please try again.', 'error');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Survey';
    }
}
```

### Step 2: Add the Survey Viewer Page

The survey-viewer.html file I created allows you to:
- Search for surveys by job number
- View all surveys for a specific job
- Display surveys with all questions, answers, and photos
- Download surveys as HTML documents
- Print surveys or save as PDF

**Usage:**
1. Upload survey-viewer.html to your site
2. Navigate to it from your team view
3. Enter a job number to see all surveys for that job
4. Click on a survey to view it
5. Use the download buttons to export

## Data Structure Reference

### Complete Survey Object
```javascript
{
  // Metadata
  jobNumber: "OE123456",
  jobId: "firebase-doc-id",
  customerName: "John Smith",
  submittedAt: "2024-12-24T10:30:00.000Z",
  submittedDate: "24/12/2024",
  submittedTime: "10:30:00",
  status: "completed",
  
  // Sections array
  sections: [
    {
      title: "Section Name",
      fields: [
        {
          question: "Question text",
          answer: "Answer value",
          photos: ["url1", "url2"] // Optional, only if photos uploaded
        }
      ]
    }
  ]
}
```

## How to Retrieve and Use Survey Data

### Example 1: Get a single survey
```javascript
async function getSurvey(surveyId) {
    const { doc, getDoc } = window.firebaseModules;
    const surveyRef = doc(window.db, 'site-surveys', surveyId);
    const surveySnap = await getDoc(surveyRef);
    
    if (surveySnap.exists()) {
        const surveyData = surveySnap.data();
        // Now you have all questions, answers, and photos
        console.log(surveyData);
    }
}
```

### Example 2: Get all surveys for a job
```javascript
async function getSurveysForJob(jobNumber) {
    const { collection, query, where, getDocs } = window.firebaseModules;
    
    const q = query(
        collection(window.db, 'site-surveys'),
        where('jobNumber', '==', jobNumber)
    );
    
    const querySnapshot = await getDocs(q);
    const surveys = [];
    
    querySnapshot.forEach((doc) => {
        surveys.push({
            id: doc.id,
            ...doc.data()
        });
    });
    
    return surveys;
}
```

### Example 3: Loop through survey data
```javascript
function processSurvey(surveyData) {
    surveyData.sections.forEach(section => {
        console.log(`Section: ${section.title}`);
        
        section.fields.forEach(field => {
            console.log(`  Q: ${field.question}`);
            console.log(`  A: ${field.answer}`);
            
            if (field.photos && field.photos.length > 0) {
                console.log(`  Photos: ${field.photos.length}`);
                field.photos.forEach(photo => {
                    console.log(`    - ${photo}`);
                });
            }
        });
    });
}
```

## Benefits of This Structure

1. **Easy to Display**: Loop through sections and fields to display in any format
2. **Easy to Export**: Questions are paired with answers, perfect for documents
3. **Photos Linked**: Photos are stored with their relevant questions
4. **Searchable**: Can search by question text or answer
5. **Flexible**: Easy to add new sections or fields without breaking existing code
6. **Document Generation**: Perfect for creating Word docs, PDFs, or HTML reports

## Testing

1. Submit a test survey with the updated code
2. Check Firebase Console to see the structured data
3. Use the survey viewer to retrieve and display it
4. Verify all questions, answers, and photos appear correctly

## Files Included

1. **conduct-survey-updated.html** - Reference showing the changes
2. **survey-viewer.html** - Complete viewer page with download functionality
3. **survey-retrieval-example.js** - Code examples for retrieving data
4. **IMPLEMENTATION_GUIDE.md** - This file

## Support

If you need help implementing this:
1. Make a backup of your original conduct-survey.html
2. Copy the new submitSurvey function into your file
3. Test with a sample survey
4. Check the browser console for any errors
5. Verify data in Firebase Console
