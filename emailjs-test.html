<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmailJS Test - Pingu Solar</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1A1A2E;
            color: #EAEAEA;
        }
        .test-container {
            background: #252541;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        h1 {
            color: #FF6B35;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: #2F2F4A;
            border: 2px solid #444;
            color: #EAEAEA;
            border-radius: 5px;
            font-size: 14px;
        }
        button {
            background: linear-gradient(135deg, #FF6B35, #00D9FF);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        button:hover {
            opacity: 0.9;
        }
        .log {
            background: #1A1A2E;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #4ECCA3; }
        .error { color: #FF6B6B; }
        .info { color: #00D9FF; }
        .config-info {
            background: #2F2F4A;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .config-info code {
            background: #1A1A2E;
            padding: 2px 6px;
            border-radius: 3px;
            color: #FFC857;
        }
    </style>
</head>
<body>
    <h1>üîß EmailJS Test & Diagnostics</h1>
    
    <div class="test-container">
        <h2>Current Configuration</h2>
        <div class="config-info">
            <p><strong>Public Key:</strong> <code>ziLnha91scpGjFABh</code></p>
            <p><strong>Service ID:</strong> <code>service_yqpb5jm</code></p>
            <p><strong>Template ID:</strong> <code>template_gsi9uir</code></p>
        </div>
        <p style="font-size: 14px; color: #9A9AB0;">These values are read from your uploaddata.html file.</p>
    </div>
    
    <div class="test-container">
        <h2>Test Email Send</h2>
        <p>Send a test email to verify your EmailJS setup:</p>
        
        <label>Customer Name:</label>
        <input type="text" id="test-name" value="Test Customer" />
        
        <label>Customer Email:</label>
        <input type="email" id="test-email" placeholder="your-email@example.com" />
        
        <label>Install Date:</label>
        <input type="text" id="test-date" value="25/12/2025" />
        
        <button onclick="sendTestEmail()">Send Test Email</button>
        
        <div class="log" id="log">
            <div class="info">‚ñ∫ Ready to send test email...</div>
        </div>
    </div>
    
    <div class="test-container">
        <h2>Troubleshooting Steps</h2>
        <ol style="line-height: 1.8;">
            <li><strong>Verify EmailJS Account:</strong> Make sure you're logged into <a href="https://dashboard.emailjs.com/" target="_blank" style="color: #FF6B35;">EmailJS Dashboard</a></li>
            <li><strong>Check Email Service:</strong> Ensure your email service (Gmail/Outlook) is connected and verified</li>
            <li><strong>Verify Template:</strong> The template must exist with ID: <code>template_gsi9uir</code></li>
            <li><strong>Template Variables:</strong> Your template should include these variables:
                <ul>
                    <li><code>{{to_email}}</code></li>
                    <li><code>{{to_name}}</code></li>
                    <li><code>{{message}}</code></li>
                    <li><code>{{subject}}</code></li>
                    <li><code>{{from_name}}</code></li>
                    <li><code>{{reply_to}}</code></li>
                </ul>
            </li>
            <li><strong>Check Browser Console:</strong> Open Developer Tools (F12) and check the Console tab for errors</li>
            <li><strong>Monthly Limit:</strong> Free accounts have 200 emails/month limit</li>
        </ol>
    </div>

    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <script>
        // Initialize EmailJS with your public key
        emailjs.init("ziLnha91scpGjFABh");
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'info',
                success: 'success',
                error: 'error'
            };
            logDiv.innerHTML += `<div class="${colors[type]}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        async function sendTestEmail() {
            const name = document.getElementById('test-name').value;
            const email = document.getElementById('test-email').value;
            const date = document.getElementById('test-date').value;
            
            if (!email || !email.includes('@')) {
                log('‚ùå Please enter a valid email address', 'error');
                return;
            }
            
            log('üöÄ Starting email send...', 'info');
            log(`üìß Sending to: ${email}`, 'info');
            
            try {
                // Determine greeting based on time
                const hour = new Date().getHours();
                const greeting = hour < 12 ? 'Good morning' : 'Good afternoon';
                
                // Format the email body
                const emailBody = `${greeting} ${name},

Octopus have passed on your details so that we can make arrangements to install solar.

We understand that your install date is ${date}.

Before this time, we will conduct a survey and walkthrough of the job at a convenient time for you.

Scaffolding will go up a few days before the date above and a collection of all rubbish will be made after the install.

If you wish to discuss this further please contact 07851158757, alternatively we will be in touch in due course.

Please do not reply to this email.
This inbox is not monitored.

Best regards,
Next Generation Utilities`;
                
                log('üìù Email body prepared', 'info');
                
                // EmailJS template parameters
                const templateParams = {
                    to_email: email,
                    to_name: name,
                    from_name: 'Next Generation Utilities',
                    reply_to: 'barry-dixon@next-gen.uk',
                    message: emailBody,
                    subject: `Solar Installation Confirmation - ${date}`
                };
                
                log('üîß Template parameters set', 'info');
                log(`   Service ID: service_yqpb5jm`, 'info');
                log(`   Template ID: template_gsi9uir`, 'info');
                
                // Send email using EmailJS
                const response = await emailjs.send(
                    'service_yqpb5jm',     // Service ID
                    'template_gsi9uir',    // Template ID
                    templateParams
                );
                
                log('‚úÖ Email sent successfully!', 'success');
                log(`   Response status: ${response.status}`, 'success');
                log(`   Response text: ${response.text}`, 'success');
                log('üì¨ Check your email inbox (and spam folder)', 'success');
                
            } catch (error) {
                log('‚ùå Email sending failed!', 'error');
                log(`   Error: ${error.message || error}`, 'error');
                
                if (error.text) {
                    log(`   Error text: ${error.text}`, 'error');
                }
                
                if (error.status) {
                    log(`   Status code: ${error.status}`, 'error');
                    
                    // Provide specific error explanations
                    if (error.status === 400) {
                        log('   ‚Üí This usually means the template ID or service ID is incorrect', 'error');
                    } else if (error.status === 401) {
                        log('   ‚Üí This means authentication failed. Check your public key', 'error');
                    } else if (error.status === 403) {
                        log('   ‚Üí This means access is forbidden. Check your EmailJS account status', 'error');
                    } else if (error.status === 412) {
                        log('   ‚Üí Template or service not found. Verify your IDs in EmailJS dashboard', 'error');
                    }
                }
                
                log('', 'info');
                log('üîç Troubleshooting suggestions:', 'info');
                log('   1. Go to https://dashboard.emailjs.com/admin', 'info');
                log('   2. Check Email Services - is your service connected?', 'info');
                log('   3. Check Email Templates - does template_gsi9uir exist?', 'info');
                log('   4. Check Account - have you exceeded the monthly limit?', 'info');
                
                console.error('Full error object:', error);
            }
        }
        
        // Test EmailJS initialization on page load
        window.addEventListener('DOMContentLoaded', () => {
            log('‚úì EmailJS SDK loaded', 'success');
            log('‚úì EmailJS initialized with public key: ziLnha91scpGjFABh', 'success');
            log('', 'info');
            log('Enter your email address above and click "Send Test Email" to test the configuration.', 'info');
        });
    </script>
</body>
</html>
